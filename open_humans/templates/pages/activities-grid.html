{% extends 'base.html' %}

{% load static from staticfiles %}
{% load utilities %}

{% block head_title %}Activities{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.0/imagesloaded.pkgd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.min.js"></script>
{% endblock %}

{% block main %}
<div class="row">
  <div class="col-md-12 toolbar-column">
    <div class="btn-toolbar" role="toolbar">
      <div class="btn-group filters" role="group">
        <button type="button" class="btn btn-default btn-sm selected"
          data-filter="*">All activities</button>

        {% if user.is_authenticated %}
        <button type="button" class="btn btn-default btn-sm"
          data-filter=".data-source:not(.connected)">New sources</button>

        <button type="button" class="btn btn-default btn-sm"
          data-filter=".share-data:not(.connected)">New sharing</button>

        <button type="button" class="btn btn-default btn-sm"
          data-filter=".connected">Connected</button>
        {% else %}
        <button type="button" class="btn btn-default btn-sm"
          data-filter=".data-source">Data sources</button>

        <button type="button" class="btn btn-default btn-sm"
          data-filter=".share-data">Share data</button>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <div class="well filter-description" data-filter="*">
      Open Humans has many activities: studies, data sources, and other
      projects!
    </div>

    <div class="well filter-description" data-filter=".data-source">
      Members can add data from the following data sources.
    </div>

    <div class="well filter-description" data-filter=".share-data">
      Members can share data with these studies and projects.
      (<a href="{% url 'direct-sharing:overview' %}">Learn about creating
        projects.</a>)
    </div>

    <div class="well filter-description"
      data-filter=".data-source:not(.connected)">
      These are potential data sources for your profile. See anything to add?
    </div>

    <div class="well filter-empty" data-filter=".data-source:not(.connected)">
      You've already connected all of the data sources!
    </div>

    <div class="well filter-description"
      data-filter=".share-data:not(.connected)">
      Share your data with these studies and projects!
      (<a href="{% url 'direct-sharing:overview' %}">Learn about creating
        projects.</a>)
    </div>

    <div class="well filter-empty" data-filter=".share-data:not(.connected)">
      You've already connected all of the sharing activities!
    </div>

    <div class="well filter-description" data-filter=".connected">
      You're already connected these data sources and sharing
      activities&mdash;congrats!
    </div>

    <div class="well filter-empty" data-filter=".connected">
      Looks like you haven't connected any activities yet!
    </div>
  </div>
</div>

<div class="grid row">
  {% for activity in activities %}
  <div class="item col-xs-12 col-md-4 {{ activity.classes }}">
    <div class="panel panel-default">
      <div class="panel-body">
        <div class="row">
          <div class="col-xs-3 col-sm-4 clearfix">
            {% badge activity.badge %}

            {% for _, label in activity.labels.items %}
            <span class="label {{ label.class }}">{{ label.name|safe }}</span>
            {% endfor %}
          </div>

          <div class="col-xs-9 col-sm-8 description">
            <div>
              <span class="h4 name">{{ activity.verbose_name }}</span>
            </div>

            {% if activity.leader %}
            <div>
              {{ activity.leader}}
            </div>
            {% endif %}

            {% if activity.organization %}
            <div>
              {{ activity.organization }}
            </div>
            {% endif %}

            <div>
              <span class="members">{{ activity.members|default:'0' }}</span>
              connected
            </div>

            <p>
              {{ activity.description }}
            </p>
          </div>
        </div>

        <hr>

        <center>
          {% url 'activities' as activities_next %}
          {% if activity.data_source %}
            {% if activity.is_connected %}
              <b>Data source connected!</b><br>

              <span class="small">
                Manage data on <a href={% url 'my-member-research-data' %}>your
                research data page</a>
              </span>
            {% else %}
              {% if activity.info_url %}
              <a href="{{ activity.info_url }}"
                class="btn btn-xs btn-default">Visit the website</a>
              {% endif %}

              {# MPB 2016/04: I'd like it if the included partial could have #}
              {# btn-default style, not btn-primary. #}
              {% if activity.add_data_text and activity.add_data_url %}
                {% with text=activity.add_data_text href=activity.add_data_url class='btn-xs' next=activities_next %}
                  {% include 'partials/import-button.html' %}
                {% endwith %}
              {% endif %}
            {% endif %}
          {% endif %}

          {% if activity.share_data %}
            {% if activity.is_connected %}
              <b>Project joined!</b>
            {% else %}
              {% with text="Join project" href=activity.join_url class='btn-xs' next=activities_next %}
                {% include 'partials/import-button.html' %}
              {% endwith %}
            {% endif %}
          {% endif %}
        </center>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
