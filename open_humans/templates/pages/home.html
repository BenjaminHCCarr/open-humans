{% extends 'base.html' %}

{% load static from staticfiles %}
{% load utilities %}

{% block head_title %}Home{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.0/imagesloaded.pkgd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.min.js"></script>
{% endblock %}

{% block body_main %}

<div class="container home-title-pic-div">
  <div class="row">
    <div class="col-sm-7 home-title-div">
      <div style="text-align:center;">
        <h1>Open Humans</h1>
        <h4 class="subtitle">
          Participate&nbsp;in&nbsp;research. Share&nbsp;your&nbsp;data. Learn&nbsp;more&nbsp;together.
        </h4>
        <a href="{% url 'about' %}" class="btn btn-default" style="margin-top:15px;">Learn more</a>
      </div>
    </div>
    <div class="col-sm-5 home-pic-div">
      <img class="home-pic hidden-xs" src="{% static 'images/your-data-plus-you-sketch.jpg' %}">
      <img class="home-pic visible-xs-block" src="{% static 'images/your-data-plus-you-sketch.jpg' %}">
    </div>
  </div>
</div>

<div class="container">
  <hr>
  <h3 class="text-center">Recent news</h3>
  <div class="row">
    {% for post in recent_blogposts %}
    <div class="col-xs-4">
      <div class="panel panel-default">
        <div class="panel-body">
          <h5>{{ post.title }}</h5>
          {% if post.image %}
          <img class="img-responsive img-thumbnail" src="{{ post.image.url }}" style="max-width: 50%;float:right;">
          {% endif %}
          <p><small>
            {{ post.summary|safe }}
          </small></p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<div class="container">
  <hr>
  <h3 class="text-center">Recent activity</h3>
  <div class="row">
    <div class="col-xs-12">
      {% for event in recent_activity reversed %}
      <p>
        {% if event.action == 'created-account' %}
        <span class="muted">{{ event.timestamp }} GMT:</span> New member! <b><a href="{% url 'member-detail-direct' event.member.user.username %}">{{ event.member.user.username }}</a></b> created an account.
        {% elif event.action == 'joined-project' %}
        {{ event.timestamp }} GMT: <b><a href="{% url 'member-detail-direct' event.member.user.username %}">{{ event.member.user.username }}</a></b> joined <b><a href="{% url 'activity-management' event.project.slug %}">{{ event.project.name }}</a></b>.
        {% elif event.action == 'joined-project' %}
        {{ event.timestamp }} GMT: <b><a href="{% url 'member-detail-direct' event.member.user.username %}">{{ event.member.user.username }}</a></b> publicly shared data from <b><a href="{% url 'activity-management' event.project.slug %}">{{ event.project.name }}</a></b>.
        {% endif %}
      </p>
      {% endfor %}
    </div>
  </div>
</div>

<div class="container">
  <hr>
  <h3 class="text-center">Featured projects</h3>
  <div class="row">
  {% for projdata in highlighted_projects %}
    <div id="project-{{ project.slug }}"
      class="item col-xs-12 col-md-4">
      <div class="panel panel-default">
        <div class="panel-body">
          <div class="row">
            <div class="col-xs-3 col-sm-4 clearfix">
              {% badge projdata.badge %}
            </div>

            <div class="col-xs-9 col-sm-8 description">
              <div>
                <span class="h4 name">{{ projdata.project.name }}</span>
              </div>

              {% if projdata.project.leader %}
              <div class="leader">
                {{ projdata.project.leader}}
                {% if projdata.project.organization %}
                <div class="organization">
                  <small class="text-muted">
                    {{ projdata.project.organization }}
                  </small>
                </div>
                {% endif %}
              </div>
              {% endif %}


              <div class="connected-members">
                <small>
                Joined by
                <b><span class="members">
                  {{ projdata.project.authorized_members|default:'0' }}
                </span></b>
                members
                </small>
              </div>

            </div>
          </div>

          <p class="activity-description">
            {{ projdata.project.short_description }}
          </p>

          <hr>

          <center>
            {% if projdata.is_connected %}
              {% if projdata.has_files %}
              <a href="{% url 'activity-management' projdata.project.slug %}"
                  class="btn btn-xs btn-default">
                Manage your data
              </a>
              {% else %}
              <span class="lead">Joined!</span><br>
              <span class="joined-subtext text-muted">
                Manage this connection on the
              <a href="{% url 'activity-management' projdata.project.slug %}"
                href="{{ activity.join_url }}">
                activity page</a>.
              {% endif %}
            {% else %}
              <a href="{% url 'activity-management' projdata.project.slug %}"
                  class="btn btn-primary btn-xs">
                <b>Learn more</b>
              </a>
            {% endif %}
          </center>
        </div>
      </div>
    </div>
  {% endfor %}
  </div>
</div>
{% endblock %}
