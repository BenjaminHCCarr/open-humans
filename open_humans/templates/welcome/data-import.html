{% extends 'base.html' %}

{% load static from staticfiles %}
{% load utilities %}

{% block head_title %}Importing data{% endblock %}

{% block main %}
<div class="row">
  {% include 'welcome/navigation.html' %}

  <div class="col-xs-12 col-sm-9 col-lg-10">
    <h3>Import other data sources</h3>

    <p>
      Import your data from other data sources &ndash; to share with other
      members, studies, or even publicly!
    </p>

    <p>
      You'll be able to share these data sets directly with individual studies.
      {% if not user.member.public_data_participant.enrolled %}You can also
      turn public sharing on (or off) on
      <a href="{% url 'my-member-research-data' %}">your research data page</a>.
      {% else %}You can also activate the option to publicly share
      individual data sets by enrolling in our
      <a href="{% url 'public-data:home' %}">Public Data Sharing study</a>. It's
      entirely "opt in": you'll be able to turn "public" status on and off
      for individual data sets.
      {% endif %}
    </p>

    <ul>
      <!-- NOTE if you make changes to this template also make them to the in
           development activities template below. --->
      {% for label, activity in activities %}

      {% with sources|lookup:label as source %}
      <li>
        <hr>

        <h4>{{ activity.verbose_name }}</h4>

        <p>{{ activity.description }}</p>

        {% if label in user.member.connections %}
          <strong>{{ activity.connect_complete }}</strong>
        {% else %}
        <p>
          If you authorize access, we'll import this data to Open Humans.
          This data may automatically update periodically.
        </p>

        <a class="btn btn-default"
          href="{{ source.href_connect }}?origin=open-humans&amp;next={{ source.href_next }}">
            {{ activity.connect_verb }} {{ activity.verbose_name }}</a>
        {% endif %}
      </li>
      {% endwith %}
      {% endfor %}

      <li>
        <hr>

        <h4>Data Selfie</h4>

        <p>
          Do you a have a data type that we don't yet support? Upload any files
          you want to your Data Selfie.
        </p>

        <p>
          Test results, medical imaging, and genetic data, or microbiome data
          are examples of data you might share. When you share new types of
          data in the Data Selfies, it makes it easier for us to add it as a
          supported data type. Of course, we'll never be able to standardize
          everything about our health and biology&mdash;sometimes you have data
          that's uniquely you!
        </p>

        <p>
          We don't do any processing of Data Selfie files.
          If you're a member of the <a href="{% url 'public-data:home' %}">
          Public Data Sharing</a> study you'll be able to share these publicly.
          It'll be your responsibility to understand what's being shared, we
          won't process them to remove potentially sensitive information.
        </p>

        {% if user.data_selfie.datafile_set.all %}
        <p>
          <b>You've added files!</b>
        </p>

        <p>
          <a class="btn btn-default"
            href="{% url 'activities:data-selfie:manage' %}">Manage files</a>
          <a class="btn btn-default"
            href="{{ sources.data_selfie.href_connect }}">Upload new files</a>
        </p>
        {% else %}
        <p>
          <a class="btn btn-default" href="{{ sources.data_selfie.href_connect }}">
            Upload files to your Data Selfie</a>
        </p>
        {% endif %}
      </li>
    </ul>

    {% if in_development_activities %}
    <h3>In development activities</h3>

    <p>
      These activities are under development. Giving Open Humans access to your
      data will help us bring them to completion!
    </p>

    <ul>
      {% for label, activity in in_development_activities %}

      {% with sources|lookup:label as source %}
      <li>
        <hr>

        <h4>{{ activity.verbose_name }}</h4>

        <p>{{ activity.description }}</p>

        {% if label in user.member.connections %}
          <strong>{{ activity.connect_complete }}</strong>
        {% else %}
        <p>
          If you authorize access, we'll use this data to finish developing a
          data processing pipeline for this activity. You'll be notified when
          processed files are available for this data.
        </p>

        <a class="btn btn-default"
          href="{{ source.href_connect }}?origin=open-humans&amp;next={{ source.href_next }}">
            {{ activity.connect_verb }} {{ activity.verbose_name }}</a>
        {% endif %}
      </li>
      {% endwith %}
      {% endfor %}
    <ul>
    {% endif %}
  </div>
</div>
{% endblock %}
