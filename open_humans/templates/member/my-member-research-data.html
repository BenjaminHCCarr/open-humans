{% extends 'member/my-member-dashboard.html' %}

{% block dashboard_main %}
<div class="panel panel-default pad-all-sides">
  <table class="table">
    <tr>
      <th>Activity</th>
      <th>Data type</th>
      <th>Date added</th>
      <th>Actions</th>
    </tr>
    {% for data_set in data_sets %}
    <tr>
      {# TODO: These needs to use descriptions from study/activity models. #}
      <td>23andme</td>
      <td>Full genotyping</td>
      <td>
        {% if data_set.dataretrievaltask.complete_time %}
        {{ data_set.dataretrievaltask.complete_time }}
        {% else %}
          Submitted at {{ data_set.dataretrievaltask.start_time }}
        {% endif %}
      </td>
      <td>
        {% if data_set.dataretrievaltask.complete_time %}
        <a class="btn btn-primary btn-xs" href="{{ data_set.file.url }}">
          Download
        </a>
          {% if user.member.public_data_participant.enrolled %}
          <form action="{% url 'public-data:toggle-sharing' %}"
              method="POST" style="display:inline-block;">
            {% csrf_token %}
            <input type="hidden" name="data_file" value="{{ data_set.file }}">
            {% if data_set.is_public %}
            <input type="hidden" name="public" value="False">
            {% else %}
            <input type="hidden" name="public" value="True">
            {% endif %}
            <input class="btn btn-primary btn-xs"
              {% if data_set.is_public %}
                value="Stop public sharing"
              {% else %}
                value="Publicly share"
              {% endif %}
              type="submit">
          </form>
          {% else %}
          <a href="#" class="popover-dismiss btn btn-xs btn-info"
            data-container="body" data-toggle="popover" data-placement="bottom"
            data-content="Only available to participants in the
              <a href='{% url 'public-data:home' %}'>Public Data Sharing</a> study.">
            Share publicly
          </a>
          {% endif %}
        {% else %}
        <b>N/A.</b> Task status: {{ data_set.dataretrievaltask.get_status_display }}
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>
  {% if not data_sets %}
  <hr>
  <p class="text-center">No data imported!</p>
  {% endif %}
</div>

{% if user.member.primary_email.verified %}
<a class="btn btn-primary" href="#" data-toggle="modal"
    data-target="#add-data-23andme-modal">
  Import 23andme data
</a>
<button class="btn btn-default" disabled>
  Import American Gut data
</button>
<button class="btn btn-default" disabled>
  Import GoViral data
</button>
<button class="btn btn-default" disabled>
  Import PGP Harvard data
</button>
{% else %}
<button data-container="body" data-toggle="popover"
  data-placement="bottom"
  class="btn btn-info popover-dismiss"
  data-content="We'd like to make sure we can contact you. Please
    validate your email to enable data import!">
  Import data
</button>
{% endif %}

{% endblock dashboard_main %}

{% block extra_modals %}
  {% include 'twenty_three_and_me/add-data-23andme-modal.html' with 23andme_data_sets=data_sets %}
{% endblock %}
